{% load staticfiles %}
<html>
    <head>
        <link href={% static '/css/main.css'%} rel="stylesheet" type="text/css"/>
        <script src={% static '/js/paging.js' %} type="text/javascript"></script>
        <script src={% static '/js/jquery-3.3.1.min.js' %} type="text/javascript"></script>
        <meta charset="utf-8">
     <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
</head>
<body>
<div class="my-stock">
    我的股票
</div>
<div class="large-market">
大盘展示图
</div>
<div class="news">
新浪新闻
</div>
<div class="stock-sequence">
<div style="float: left"></div>
 <table class="sequence-table" id="sequence-table">
    <tr class="index">
         {% csrf_token %}
            <td>序号</td>
            <td >代码</td>
            <td >名称</td>
            <td>昨收价 <div>
                <img src="{% static "/image/up.png" %}"  onclick="sort_100('1','pre_close')">
                <img src="{% static "/image/down.png" %}"  onclick="sort_100('0','pre_close')">
                </div>
            </td>
            <td>今开价<div>
                <img src="{% static "/image/up.png" %}"  onclick="sort_100('1','open')">
                <img src="{% static "/image/down.png" %}"  onclick="sort_100('0','open')">
                </div>
            </td>
            <td>今最高价<div>
                <img src="{% static "/image/up.png" %}"  onclick="sort_100('1','high')">
                <img src="{% static "/image/down.png" %}"  onclick="sort_100('0','high')">
                </div>
            </td>
            <td>今收价<div>
                <img src="{% static "/image/up.png" %}"  onclick="sort_100('1','close')">
                <img src="{% static "/image/down.png" %}"  onclick="sort_100('0','close')">
                </div>
            </td>
            <td>涨幅(%)
                <div>
                <img src="{% static "/image/up.png" %}"  onclick="sort_100('1','pct_chg')">
                <img src="{% static "/image/down.png" %}"  onclick="sort_100('0','pct_chg')">
                </div>
            </td>
            <td>涨跌额<div>
                <img src="{% static "/image/up.png" %}"  onclick="sort_100('1','change')">
                <img src="{% static "/image/down.png" %}"  onclick="sort_100('0','change')">
                </div>
            </td>
            <td>成交额(千元)<div>
                <img src="{% static "/image/up.png" %}"  onclick="sort_100('1','amount')">
                <img src="{% static "/image/down.png" %}" onclick="sort_100('0','amount')">
                </div>
            </td>
            <td>操作</td>
        </tr>
    <tbody id="paging_table">
    </tbody>
    </table>
    <div class="paging">
        <span id="spanFirst">第一页</span>
        <span id="spanPre">上一页</span>
        第<span id="spanPageNum"></span>页/共
        <span id="spanTotalPage"></span>页
        <span id="spanNext">下一页</span>
         <span id="spanLast">最后一页</span>
     </div>
</div>
</body>
<script>
    var theTable = document.getElementById("paging_table");
    var totalPage = document.getElementById("spanTotalPage");
    var pageNum = document.getElementById("spanPageNum");
    var spanPre = document.getElementById("spanPre");
    var spanNext = document.getElementById("spanNext");
    var spanFirst = document.getElementById("spanFirst");
    var spanLast = document.getElementById("spanLast");
    var numberRowsInTable = 100; //显示的数量
    var pageSize = 8;
    var page = 1;
$(function () {
    sort_100('1','pct_chg')  //默认涨跌排序pct_chg为从大到小排列
})

 function to_stockDetails(obj){
     var post_data={
         "ts_code":$(obj).parents("tr").find("#ts_code").text(),
         "csrfmiddlewaretoken":$("[name='csrfmiddlewaretoken']").val()
     }
     $.ajax({
                url:  '/query_stockDetails/',
                type: "POST",
                data: post_data,
                success: function (data) {
                    window.location.href="/show_stockDetails/"
                }
            });
 }

 function sort_100(variable1,variable2){
     var post_data={
         "how":variable1,//上升或者下降
         "type":variable2,//数据种类
         "csrfmiddlewaretoken":$("[name='csrfmiddlewaretoken']").val()
     }
      $.ajax({
                url:  '/get_sort/',
                type: "POST",
                data: post_data,
                success: function (data) {
                    var stocks=JSON.parse(data); //可以将json字符串转换成json对象
                    $("#paging_table").html('')
                    if (variable1=='0'){
                        var color1="#00FA9A";
                        var color2="#90EE90";
                    }
                     if (variable1=='1'){
                        var color1="#ef232a";
                        var color2="#ffa400";
                    }
                   for( var i in stocks ) {
                      htmlStr= '<tr>'
                          +' <td>'+i+ '</td>'
                          +' <td class="point" id="btn" onclick="to_stockDetails(this)" style="color:#4169E1" > '+stocks[i].symbol+'<span id="ts_code" hidden>'+stocks[i].ts_code+'</span></td>'
                          +' <td class="point" id="btn" onclick="to_stockDetails(this)"style="color:#4169E1">'+ stocks[i].name+'</td>'
                          +' <td style="color:'+color1+'">'+ stocks[i].pre_close+'</td> '
                          +' <td style="color:'+color1+'">'+ stocks[i].open+'</td> '
                          +' <td style="color:'+color2+'">'+ stocks[i].high+'</td>'
                          +' <td style="color:'+color2+'">'+ stocks[i].close+'</td>'
                          +' <td style="color:'+color1+'">'+ stocks[i].pct_chg+'</td>'
                          +' <td style="color:'+color1+'">'+ stocks[i].change+'</td>'
                          +' <td >'+ stocks[i].amount+'</td>'
                          +'  <td><button  class="show-details-bt" type="button" id="show_detail" onclick="to_stockDetails(this)">查看更多详情</button></td>'
                          +'</tr>'
                       $("#paging_table").append(htmlStr)
                   }
                   paging()
                }
      });

 }
</script>
</html>